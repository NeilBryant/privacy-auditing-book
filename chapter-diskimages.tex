\documentclass{book}
\usepackage{url}
\usepackage{fancyvrb}
\begin{document}
\chapter{Forensic Data}

Today there are three fundamental kinds of forensic data:

\begin{itemize}
\item Disk Images
\item Memory Images
\item Packets intercepted on a network.
\end{itemize}

Most research to date has been done with Disk images. Most data is
stored on disk, and most forensic investigations have been for the
purpose of finding information that is on a disk (such as in the case
of a child pornography investigation), or in trying to understand
information left behind on a disk (for example, after an intrusion or
malware incident.

It is also common to find the other kinds of information on disk
images. Memory is frequently stored on disk images from swapping
(e.g. PAGEFILE.SYS on Windows) or system hibernation
(HIBER.SYS). Packets are found on image files when the disks were used
to store the results of a network interception.

Working with image files can consists of these activities:


\begin{itemize}
\item Copying the data from the source drive into the image file, a
  process called \emph{drive imaging}.
\item Computing the checksum of the disk image.
\item Validating the copy against the original.
\item Creating a digital signature for the disk image.
\item Self-validating the copy.
\item Making backup copies of the disk image, and validating the integrity
  of the backups.
\item Converting the disk image into a form that can be used by your
  forensic tool
\end{itemize}.

On the \url{digitalcorpora.org} website there are several disk images with
which you can work. We're going to do our initial work with the image
nps-2009-canon2-gen6. This image is usually stored in the directory
/corp/drives/nps/nps-2009-canon2/.

The nps-2009-canon2 disk images are a series of images created with a
Canon digital camera and a 32MB SD card. First the card was
\emph{cleared} using |dd| on a Linux computer. The card was then
inserted into the digital camera, a series of photos were taken, and
the card was removed and imaged. The card was put back into the
camera, some of the photos were deleted, and new photos were
taken. This process was repeated five times, creating a total of six
disk images, nps-2009-canon2-gen1 through nps-2009-canon2-gen6.

The SD card contained 60,800 512-byte sectors, for a total of
31,129,600 bytes (30,400 KiB).

For each disk image four files are distributed:

   .raw -- a DD disk image that's 31,129,600 bytes in length
   .aff -- an AFF disk image of the same file
   .E01 -- An EnCase E01 file of the disk image
   .xml -- A digital forensics XML file describing the files resident
           in the disk image.


It is customary in digital forensics to use cryptographic hashes to
verify the integrity of a disk image. When the disk is first imaged
the hash is recorded in a secure manner (typically written in in
investigator's notebook). From that point forward, the image can be
manually validated by recomputing the hash and comparing it to the
original recording.

The hash of a raw file can be easily calculated the ``openssl''
command:

\begin{Verbatim}
$ openssl md5 /corp/drives/nps/nps-2009-canon2/nps-2009-canon2-gen6.raw
MD5(/corp/drives/nps/nps-2009-canon2/nps-2009-canon2-gen6.raw)=750b509d8fbed37a5213480aaccfdc61
$ 
\end{Verbatim}

You can't calculate the hash of an AFF or E01 file in this manner,
however, because these files contain additional metadata that is not
part of the disk image.  Both of these formats also store hash codes
directly in the disk image. This allows you to \emph{validate} the
contents of a disk image with a command that calculates the hash by
examining the data and comparing it with the stored value. 

\subsection{E01 files}
You can use the ewfinfo command to view the metadata information of a
disk image:

\begin{Verbatim}
% ewfinfo /corp/drives/nps/nps-2009-canon2/nps-2009-canon2-gen6.E01 
ewfinfo 20090927 (libewf 20090927, libuna 20090901, libbfio 20090927, zlib 1.2.3, libcrypto 0.9.8)

Acquiry information
Acquiry date:Mon Apr 12 08:12:32 2010
System date:Mon Apr 12 08:12:32 2010
Operating system used:Darwin
Software version used:20090927
Password:N/A

EWF information
File format:EnCase 6
Sectors per chunk:64
Error granularity:64
Compression type:no compression
GUID:dc032794-bef0-2c45-8ede-8cc01ed31683

Media information
Media type:removable disk
Is physical:no
Bytes per sector:512
Amount of sectors:60800
Media size:29 MiB (31129600 bytes)

Digest hash information
MD5:750b509d8fbed37a5213480aaccfdc61

% 
\end{Verbatim}


You can verify the contents of an E01 file using the ewfverify
command:

%% BEGIN NO FILL
\begin{Verbatim}
$ ewfverify /corp/drives/nps/nps-2009-canon2/nps-2009-canon2-gen6.E01 
ewfverify 20090927 (libewf 20090927, libuna 20090901, libbfio
20090927, zlib 1.2.3, libcrypto 0.9.8)

Verify started at: Mon Jun  7 14:20:20 2010

This could take a while.

Status: at 0%.
        verified 32 KiB (32768 bytes) of total 29 MiB (31129600 bytes).

...

Status: at 100%.
        verified 29 MiB (31129600 bytes) of total 29 MiB (31129600 bytes).

Verify completed at: Mon Jun  7 14:20:20 2010

Read: 29 MiB (31129600 bytes) in 0 second(s).

MD5 hash stored in file:750b509d8fbed37a5213480aaccfdc61
MD5 hash calculated over data:750b509d8fbed37a5213480aaccfdc61

ewfverify: SUCCESS
$ 
\end{Verbatim}
%% END NO FILL


\subsection{AFF1 files}
AFF1 files can store MD5 and SHA1 inside. You can display the
information with the afinfo command:

%% BEGIN NO FILL
\begin{Verbatim}
% afinfo -a /corp/drives/nps/nps-2009-canon2/nps-2009-canon2-gen6.aff
/corp/drives/nps/nps-2009-canon2/nps-2009-canon2-gen6.aff is a AFF file

/corp/drives/nps/nps-2009-canon2/nps-2009-canon2-gen6.aff
                                        data       
Segment                       arg      length    data
=======                 =========    ========    ====
badflag                         0        512   BAD SECTOR....9....5}..:.7.>....
badsectors                      2          8   = 0 (64-bit value)
afflib_version                  0          7   ``3.5.5''
creator                         0          9   afconvert
aff_file_type                   0          3   AFF
acquisition_commandline         0         67   afconvert /corp/drives/nps/nps-2
pagesize                 16777216          0   
sectorsize                    512          0   
page0                           1   16498776   x....XU...?W...-..]''R. ..JH.t).(
page1                           1   14171768   x...uX.....c..Q.2d...HI7J.t)]...
imagesize                       2          8   = 31129600 (64-bit value)
md5                             0         16   750B 509D 8FBE D37A 5213 480A ACCF DC61 
sha1                            0         20   4742 C325 F105 83DA B1EB 4C55 D0D4 
                                               5AB3 BEB9 9EB3 
image_gid                       0         16   258E FE7D 86A0 B08C BD89 8123 A206 9E22 
acquisition_date                0         20   2009-04-13 20:09:54.

Total segments:              15   (15 real)
  Page  segments:             2
  Hash  segments:             0
  Signature segments:         0
  Null segments:              0
  Empty segments:             0

Total data bytes in segments: 30671230
Total space in file dedicated to segment names: 143
Total overhead for 15 segments: 360 bytes (15*(16+8))
Overhead for AFF file header: 8 bytes
%  
\end{Verbatim}
%% END NO FILL

The afverify command can be used to verify that the hash in the file
matches the hash of the pages:

%% BEGIN NO FILL
\begin{Verbatim}
% afverify /corp/drives/nps/nps-2009-canon2/nps-2009-canon2-gen6.aff
/corp/drives/nps/nps-2009-canon2/nps-2009-canon2-gen6.aff: no signing certificate present. 
SHA1 stored in file:     4742c325f10583dab1eb4c55d0d45ab3beb99eb3
MD5 stored in file:      750b509d8fbed37a5213480aaccfdc61

  Read              0/      31129600 bytes; done in n/a
  Read       16777216/      31129600 bytes; done in 00:00:00

Calculated SHA1: 4742c325f10583dab1eb4c55d0d45ab3beb99eb3  VERIFIES
Calculated MD5:  750b509d8fbed37a5213480aaccfdc61          VERIFIES
% 
\end{Verbatim}
%% END NO FILL



\subsection{Exercises}
\begin{itemize}
\item Download an install the following programs in this order:
\begin{itemize}
\item   libewf
\item afflib
\item  sleuthkit
\end{itemize}
\item Download nps-2009-canon2-gen6.aff, nps-2009-canon2-gen6.e01 and nps-2009-canon2-gen6.raw
\item Verify the SHA1 of each file. Verify the RAW with the openSSL
  command and make sure that it matches what is in this book. Use the
  ewfverify and afverify commands to verify that the hash codes stored
  in the AFF and E01 files match the computed values.
\item Convert the RAW file to an AFF and E01 files. Notice that the
  files are different than the distribution AFF and E01 files.
\item Verify your converted files.
\item Convert the distribution AFF and E01 files back to raw files and
  use the Unix |cmp| command to show that the resulting files match
  the distribution raw file.
\end{itemize}

\end{document}
