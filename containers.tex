\chapter{Forensic Containers and Forensic Device Imaging}
The introduction of digital forensics into law enforcement as a formal
practice in the 1990s made two differences between traditional
forensics and digital forensics abundantly clear:
\begin{compactenum}
\item Whereas a major challenge with traditional forensics is the
  securing of the crime scene and the collection of representative
  evidence, it is relatively straight-forward to isolate a ``digital
  crime scene'' by turning off a computer and removing its hard
  drive. 
\item Whereas in the physical world it is generally possible to
  prevent or at least detect inadvertent (or intentional) damage to
  evidence, it is generally possible to make undetectable
  changes to digital evidence.  For example, it can be generally determined through
  forensic examination that a page has been torn out of a notebook,
  but it is generally not possible to tell that a sector that
  containing an email  address such as \emph{user1234@aol.com} was
  overwritten to read \emph{usr3@hotmail.com}.
\end{compactenum}

The original purpose of \emph{forensic containers} was to overcome
both of these limitations by providing a facility for making a copy of
data that was faithful to the original and for which 
subsequent changes to the contained data could be detected. Since then
a number of other requirements have emerged, as shown in
\tabref{container:requirements}. The Advanced Forensic Format version
3\cite{garfinkel:aff} is the only forensic container format that
currently satisfies all of these requirements.

In addition to those requirements, it
can be useful for evidence containers to provide additional
functionality, including:

\begin{table}
\begin{itemize}
\item Provide a general purpose facility for  storing case information.
\item Provide an integrity check on the contents of the evidence. This
  is typically implemented with a cryptographic hash.
\item Provide a digital signature on the evidence, typically provided
  by signing the cryptographic hash with a private key. Ideally this
  signature should be created with a key that is embedded in the
  device that acquires the evidence using a hardware security module.
\item Likewise, evidence containers should provide for integrity
  checks and digital signatures for metadata.
\item Allow evidence and metadata to be encrypted so that it cannot be accessed
  by unauthorized parties. Encryption can be performed using a
  password, a symmetric encryption key, or an asymmetric key. The use
  of an asymmetric key (for example, an X.509 public key certificate)
  allows evidence to be acquired in the field in such a way that it
  cannot be reviewed by those who acquire it, and can only be decoded
  when the evidence is returned to the lab where the private key
  resides.
\item Maintain a record of the evidence provenance, including the device from which the evidence was
  extracted, who did the extraction, what tools were used, when and
  where the extraction took place, and other similar information.
\item Maintain a record of the evidence chain-of-custody as it moves
  from one data custodian to another.
\end{itemize}
\caption{Requirements for a digital evidence container.}\label{container:requirements}
\end{table}


\begin{itemize}
\item Provide for the exchange of evidence and forensic
  work product between different examiners and different tools.
\item Store intermediate results, reducing the need for
  reprocessing evidence and speeding the examination process.
  Typical intermediate results include cryptographic hashes of files
  and full-text indexes of file contents.
\end{itemize}

Most forensic containers in use today provide integrity checks for
evidence but not for metadata. TK

\section{Background}

This chapter is primarily concerned  with the collection and preservation of
digital information from \emph{mass storage} or \emph{secondary
  storage} devices. 

\emph{Storage} is a term that is used in computing to refer to a
system that can hold information and allow the information to be
retrieved at a later point in time. 

In computing the word \emph{store}
is used both as a verb (the act of storing the information) and a noun
(the place where the information is stored). Computer systems have two
kinds of storage systems:

\begin{description}
\item[Primary Storage] is storage that can be directly accessed by the
  computer's central processing unit (CPU). Most computers use
  \emph{Random Access Memory} (RAM) as their primary storage, although
  some systems can also use a special kind of flash memory called
  \emph{NOR Flash}. 

\item[Secondary Storage] is storage that cannot be directly accessed
  by the CPU. To use secondary storage, information must be copied
  between secondary storage and primary storage. Typically these copy
  operations are performed on fixed-sized \emph{blocks} of data.
\end{description}

Even though this chapter is concerned with data on mass
storage system, we will see that forensic containers need to be able
to store a wide variety of other kinds of information, including
network packets, memory dumps, and even individual files. These
additional modalities are required for a variety of reasons:

\begin{itemize}
\item Data from networks or memory is frequently found on subject hard
  drives. When it is found, it is useful for the forensic examiner to
  extract that data and store it in its own container. 
\end{itemize}

\subsection{Storing Bits, Bytes and Sectors with Mass Storage Systems}

Computers store information in digital form, that is, as a series of
0s and 1s called \emph{bits} (short for ``binary digit'').

Modern computers do not work with bits directly, but use sequences of
8 bits called bytes. This sequence can represent
$2\times2\times2\times2\times2\times2\times2\times2=2^8=256$ distinct
values. The meaning assigned to these values generally depends on the
context. A few examples are shown in \tabref{tab:8bits}. The ASCII
codes represent NULL (no data is sent), SOH (Start Of Heading---the
beginning of a data header), and DEL (delete). NULL is a holdover from
the days of synchronous terminals, when there needed to be a constant
flow of data down all links: sending all 0s (NUL) meant that the data
should be ignored. DEL was chosen as delete when characters were
punched on paper tape and cards: in the event of an error, the
operator could backspace the punch and punch holes across the entire
line, causing the computer to ignore the value. We shall return
to the question of representation in \chapref{chap:unicode}.

\begin{table}
\begin{tabular}{cccccccc|c|c|c|c}
\multicolumn{8}{r}{                       Term:}  & unsigned char & signed char & ASCII \\
\multicolumn{8}{r}{                       Range:} & 0--255      & -128--127 & NULL--DEL\\
\cline{9-11}\multicolumn{8}{c}{Bits}                          &        &               &             &          \\
$2^7$ & $2^6$ & $2^5$ & $2^4$ & $2^3$ & $2^2$ & $2^1$ & $2^0$  &        &               &             &          \\
  128 &    64 &   32 &    16 &     8 &     4 &     2 &     1  &        &               &             &          \\
\hline
    0 &     0 &    0 &     0 &     0 &     0 &     0 &     0 &            0  &            0  &   NULL     \\
    0 &     0 &    0 &     0 &     0 &     0 &     0 &     1 &            1  &            1  &   SOH      \\
    0 &     1 &    0 &     0 &     0 &     0 &     0 &     1 &           65  &           65  &   A        \\
    0 &     1 &    1 &     0 &     0 &     0 &     0 &     1 &           96  &           65  &   a        \\
    0 &     1 &    1 &     1 &     1 &     1 &     1 &     1 &           127 &          127  &   DEL      \\
    1 &     0 &    0 &     0 &     0 &     0 &     0 &     0 &           128 &         -128  &   n/a      \\
    1 &     1 &    1 &     1 &     1 &     1 &     1 &     1 &           255 &           -1  &   n/a      \\
\end{tabular}
\caption{Eight bits can represent 256 distinct values.}\label{tab:8bits}
\end{table}

As indicated above, while the primary storage system of most computers can be accessed a
byte at a time, secondary storage can only be accessed in
blocks. Secondary storage, in turn, can be divided into two broad
categories:

\begin{description}
\item[Block addressable] storage systems are systems for which any
  block can be individually read or written. Each block in a block
  addressable system is assigned a \emph{logical block address}
  (LBA). 
\item[Streaming] storage systems are those that allow blocks to be
  read or written as part of a sequence. Most streaming systems are
  based on a spool of magnetic or optical tape. New blocks can be
  written to the tape and the tape supports limited operations---for
  example, \emph{rewind}, writing a \emph{mark}, \emph{seeking} to a mark,
   \emph{erasing} and possibly \emph{overwriting}. In general it is
   not possible with a streaming system to reliably overwrite a single
   block---attempts to do so may result in other blocks being damaged
   and rendered unreadable.
\end{description}

Confusingly, although we have used the term \emph{block} exclusively
until now, many vendors use the term \emph{sector} to describe blocks
that are written to spinning discs. (The term is presumably comes from
the fact that data was originally stored in concentric circles on a spinning platter
and in bands on a rotating magnetic drum. Thus, each block occupied a
sector of a circle.) Until the mid 2000s most mass storage systems
used blocks (sectors) that were 512 bytes in size. Since then vendors
have moved to systems that use 4096-byte blocks internally, although
many still give the appearance of using 512-byte sectors to provide
for software compatibility. 

\subsection{How many bytes? GB vs. GiB}

There are two standards used in computing to represent the size of a
storage system: SI (the International System of Units) decimal
prefixes and IEC (International Electrotechnical Comission) 60027
binary prefixes. This situation is confusing because until recently
the SI prefix names \emph{kilo}, \emph{mega} and \emph{giga} were used
both to decimal and binary notation, the correct multiplier being
inferred from usage. Today there is an effort underway to clarify
usage. This section describes correct usage and provides hints for
determining when usage is incorrect.

SI decimal prefixes are commonly used to represent metric
quantities. The SI prefix ``giga'' multiplies the following value by $10^9$; thus a gigabyte (GB) is
$10^9=1,000,000,000$ bytes. Confusingly, this is called a ``billion
bytes'' in the US but a ``thousand million'' bytes in Great Britain.

The IEC 60027 prefix ``gibi'' multiples the following value by $2^{30}$. A gibibyte
(GiB) is thus $2^{30}=1,073,741,824$ bytes. At least, this has been
proper usage since 1999 when the IEC adopted 60027-2 for binary
prefixes. 

The confusion dates back to the early 1990s. At the time the SI
prefixes were widely used in the computing industry to as binary
multiplier: \emph{kilobyte} meant 1024 bytes, \emph{megabyte} meant
$1024\times1024=1,048,576$ bytes and a \emph{gigabyte} (an
unimaginable amount of memory at the time) meant
$1024\times1024\times1024=1,073,741,824$ bytes. These terms were most
commonly used to describe the size of primary memory systems. Because
the systems were addressed with binary address lines, a system with 24
address lines could address $2^{24}=16,777,216$ bytes of
memory. Terminology at the time was to say that such a system had a
``sixteen megabyte address space.''

Vendors of mass storage systems had long realized that they could
save money by rating their storage systems using the true meaning of
the SI prefixes. That is, a hard drive sold as being a ``100 gigabyte
hard drive'' could legitimately be sold with 100,000,000,000 bytes of
physical storage. Assuming 512-byte sectors, such a system would only
need to have:
\begin{equation}
\frac{100 \times 10^9 \textrm{~bytes}}{512 \textrm{~bytes per sector}}=195,312,500 \textrm{~physical sectors}
\end{equation}

However, if the hard drive vendor adopted common usage at the time, a
``100 gigabyte'' drive would actually need to have:
\begin{equation}
\frac{100 \times 2^{30} \textrm{~bytes}}{512 \textrm{~bytes per sector}}=209,715,200 \textrm{~physical sectors}
\end{equation}
Unlike primary storage, secondary storage is addressed by sending a
logical block address down a bus. There is no technical advantage to
filling out the last 10 million sectors, and for hard drive vendors
there is a real cost to insuring that an additional 10 million usable
sectors are present on the drive. 

None of this was a problem as long as purchases were confined to a
relatively small group of informed individuals. But as the market for
storage systems increased, so did the confusion. As a result, the IEEE
Standards Board realized that it could not change the SI prefixes for
computing, and instead adopted a new set of prefixes to describe
binary multipliers. (See
\url{http://physics.nist.gov/cuu/Units/binary.html} for more information.)

\subsection{Drives, Hard Drives, Solid State Drives}

\subsection{Write Blockers}

Removable media such as floppy disks, tapes and storage cartridges
used in the 1990s generally had some kind of \emph{write-protect}
switch or tab that could be used to prevent inadvertant alternation or
overwriting of evidence. Hard drives of the time had no such
facility. To overcome this deficiency the industry invented
\emph{write-blockers}, a device that can be inserted inline between a
hard drive and a computer system. A typical write blocker might have a
male and a female ATA-33 connector; the female connector plugs into
the hard drive's male ATA-33 connector, while the blocker's male
connector plugs into a cable that connects to the host computer.

Write blockers allow examination of subject data without fear of
inadvertently modifying the contents---provided that the write blocker
works properly. A problem with the concept of write blockers is that
the only real specification of what these devices should do was their
name---that is, they should block modification of data on the hard
drive.  But there
are two ways to do this. One is to literally block the commands that
alter data, a task that requires a clear enumeration of all such
commands. An alternative (and somewhat safer) strategy is to only pass
those commands that are known \emph{not} to alter
data\cite{dfrws2006:JamesLyle}. Both of these approaches
implicitly assume that the only way data is altered on the drive is
through the execution of commands, and this is not actually the
case. For example, the S.M.A.R.T. counters inside modern drives that
track the number of seconds the drive is powered up will continue to
advance even when a write-blocker is in place.

\subsection{Disk Imaging and Disk Images}
Two problems that are not solved by write blockers. First, the
digital evidence still resides on the original media, which is a
mechanical device and subject to failure. Second, most legal systems
allow for both parties to have access to evidence. Both of these
problems can be overcome by making a sector-for-sector copy of the
disk, a process called \emph{disk imaging}.

The most basic way to image a disk is to copy every sector onto
another disk of the manufacturer and model number. Such a disk is
called a \emph{mirror copy} or \emph{mirror volume}. Once the copy is made, the subject disk
can be kept sealed in an evidence locker and the mirror volume can be
used for forensic analysis. 

A difficulty in making a mirror copy is that it may not be possible to
obtain a drive of the exact make and model number. Fortunately, it is
only necessary for the copy disk to be larger than the original. The
sectors between the end of the original disk and the copy disk should
be ignored.

[Figure: original disk, copy, and the section to ignore.]

\citeN{dfrws2002:JamesLyle} introduced the Computer Forensic Tool Testing (CFTT)
program at the National Institute of Standards and Technology (NIST).

\subsection{Inaccessible Information}

TK - DCO and HPA

TK - SMART information

\section{Image Files}
Instead of making a copy to a mirror disk, it is possible to copy all
of the accessible blocks on a mass storage system into a single file
on a computer disk. Such files are called \emph{image files} because
they represent an image of the information stored on the disk. The
term ``image'' here should not be confused with the other usage of the
word ``image'' to describe a photograph.

A raw disk image is a byte-for-byte copy of a mass storage
system. Such files can be quite large---a 256GB drive will have a raw
image that is 256GB in size. This can cause problems, as many computer
systems cannot operate on files that are larger than 2GiB or 4GiB due
to 32-bit limitations. One way to address the file size limitation is
by splitting the file into multiple files of equal size---for example,
a 256GB disk image can be split into 256 files of 1GB each. Such
collections of files are called \emph{split raw images}; each file is
typically given a name such as \emph{FILENAME.000}, \emph{FILENAME.001},
\emph{FILENAME.002} and so on.

A second and more important problem with raw image files is that they
lack important \emph{metadata} about the process by which they were
acquired. Metadata is data about data; in the case of files in a file
system the metadata includes the file's name, timestamps, and other
kinds of file system information. But in the case of disk images,
there is a wealth of additional metadata that can be collected, such
as:

\begin{itemize}
\item The date and time that the disk was imaged.
\item The manufacturer, model number, and serial number of the disk
  that was imaged.
\item The examiner that did the imaging.
\item The physical location where the image was made.
\item Other notes about the imaging process or the physical artifact.
\end{itemize}

There is also need for integrity controls to assure that the disk was
properly imaged and that the image itself was not altered or corrupted
after the file was created. A common integrity control is to compute
the cryptograhpic hash of the disk image's bitstream, computed by
feeding all of the bytes in the disk image into a hash function such
as MD5 or SHA1. Cryptographic hashes have the property that changing a
single bit causes the resulting hash function to change
unpredictably. In practice, the examiner computes the hash of the disk
image and stores this information separately---for example, by writing
it in a notebook. The disk can then be imaged a second time. If the
two disk images have the same hash, then the examiner can assume that
the image itself is a faithful copy of the source disk. Later, the
examiner can re-calculate the hash of the disk image to show that the
image has not been modified.

Compression can significantly shrink the size of a disk image
file. Although it is tempting to such programs such as ZIP and GZIP
directly on a raw file, the resulting file must be entirely
decompressed before it can be used. For files larger than a gigabyte
this quickly proves unworkable. Instead, it is common practice to
use a file format that breaks the raw disk image into blocks or
segments and compresses each individually. These segments are then
stored in the resulting image file, along with some kind of map that
describes, for each segment, the offset within the original uncompressed file
and the physical offset of the compressed segment in the compressed file.

[Diagram showing the original file, the compressed file, and the map]

\subsection{Image File Formats}
Today a wide number of image file formats are in use. Broadly
speaking, there are formats that were developed for digital forensics
and those developed for mainstream computing. Within the set of
formats developed for digital forensics, there are \emph{proprietary formats} that were developed by
vendors for commercial tools and \emph{open source} formats that were
largely developed for academic purposes. However the distinction can
be misleading, as there exists several open source implementations for
the proprietary formats, making them somewhat open source. 

\subsubsection{Proprietary Forensic Formats}

SafeBack~\cite{safeback}, a DOS-based utility designed to create
exact copies of entire disks or partitions, offers a
``self-authenticating'' format for images, whereby SHA256 hashes are
stored along with data to ensure the latter's integrity.  Although
few technical details are disclosed publicly, SafeBack's authors
claim that the software ``safeguards the internally stored SHA256
values''~\cite{safebacksafeguards}.


The most widely disk image format appears to be Guidance Software's EnCase Forensic~\cite{encase} uses
a proprietary format for images, reportedly based on ASR Data's
Expert Witness Compression Format~\cite{ew}.  EnCase's Evidence File
(.E01) format~(Fig.~\ref{fig:encase}) contains a physical bitstream
of an acquired disk, prefixed with a ``Case Info'' header,
interlaced with CRCs for every block of 64 sectors~(32 KB), and
followed by a footer containing an MD5 hash for the entire
bitstream.  Contained in the header are the date and time of
acquisition, an examiner's name, notes on the acquisition, and an
optional password; the header concludes with its own CRC. 

The E01 format allows for the contents of a disk image to be
compressed. Each image volume contains a so-called ``jump table'' that
contains the offset of each block in the original uncompressed disk,
the offset in the disk image of the compressed block, and the size of
the compressed block. Originally offsets were described with 32-bit
signed integers, limiting the size of the disk image volume to 2GiB;
additional volume files with extensions E02, E03, and so on could be
added to create images of disks that could not fit within a single
volume. The EnCase imager allows the user to specify a maximum size
for each of these files: setting the size to 700MB allows each volume
to be burned to a CD-R. 

AccessData's Forensic Toolkit (FTK)
supports storage of disk images in EnCase's or SMART's file format,
as well as in raw format and an older version of Safeback's format
(Section~\ref{sec:safeback}). 

\subsection{ILook Investigator's IDIF, IRBF, and IEIF Formats}
ILook Investigator v8~\cite{ILookv8} and its disk-imaging
counterpart, IXimager, offer three proprietary, authenticated image
formats: compressed (IDIF), non-compressed (IRBF), and encrypted
(IEIF). Although few technical details are disclosed publicly,
IXimager's online documentation~\cite{IXimager} provides some
insights:  IDIF ``includes protective mechanisms to detect changes
from the source image entity to the output form'' and supports
``logging of user actions within the confines of that event;''  IRBF
is similar to IDIF except that disk images are left uncompressed;
IEIF, meanwhile, encrypts said images.

For compatibility with ILook Investigator v7 and other forensic
tools, IXimager allows for the transformation of each of these
formats into raw format.

\subsection{ProDiscover Family's ProDiscover Image File Format}
Used by Technology Pathways' ProDiscover Family of security tools
\cite{prodiscover}, the ProDiscover Image File format
\cite{prodiscoverformat} consists of five parts: a 16-byte Image
File Header, which includes a signature and version number for an
image; a 681-byte Image Data Header, which contains user-provided
metadata about the image; Image Data, which comprises a single block
of uncompressed data or an array of blocks of compressed data; an
Array of Compressed Blocks sizes (if the Image Data is, in fact,
compressed); and I/O Log Errors describing any problems during the
image's acquisition.

Though well documented, the format is not extensible.


\subsubsection{Open Source Forensic Formats}

Supported by PyFlag\footnote{In addition to its own {\tt sgzip} format,
PyFlag can also read and write the Expert Witness Compression Format
\cite{pyflagiosources}.}~\cite{pyflag}, a ``Forensic and Log
Analysis GUI'' begun as a project in the Australian Department of
Defence, {\tt sgzip} is a seekable variant of the {\tt gzip} format.  By
compressing blocks (of 32KB, by default) individually, {\tt sgzip} allows
for rapid accessing of the disk image by forensic software without the
need to first decompress the entire image. The format does not associate metadata with images.
\cite{pyflagdiskforensics,pyflagiosources}



\citeN{dfrws2005:PhilipTurner} introduced \emph{digital evidence bags}
as a way of supporting \emph{selective imaging}. Turner's file format
is similar to EnCase's L01 format in that it supports logical files in
addition to physical sectors.

\section{Non-Forensic Evidence File Formats}

Other file formats are commonly used  by forensic
practitioners. Unfortunately, widespread use of a format does not make
it appropriate for computer forensics. These formats typically lack
one or more of the forensic requirements

Problems:

 -

\subsection{Non-Forensic Image File Formats}

DMG  (TK)

VMDK (TK)


\subsection{Other File Formats}


PCAP (TK)

ZIP (TK)

\section{Cell Phones}
\cite{dfrws2011:TimothyVidasAndChengyeZhangAndNicolasChristin}


\section{Other Issues}
\subsection{Error Rates (Storage)}

The problem with 

% ;login: article


% October 5


